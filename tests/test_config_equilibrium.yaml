# Test configuration for Equilibrium IDS

# Field-level exceptions for validation
field_exceptions: {}

# Requirement validation settings
requirement_validation:
  allow_different_shot: []

# OMAS path mapping for comparison (ODS access)
# Maps imas_composer notation to OMAS ODS access paths
# imas_composer uses clean paths (e.g., equilibrium.time_slice.time)
# OMAS uses array markers with .: notation (e.g., equilibrium.time_slice.:.time)
omas_path_map:
  # Code metadata
  equilibrium.code.name: equilibrium.code.name
  equilibrium.code.version: equilibrium.code.version

  # IDS properties
  equilibrium.ids_properties.homogeneous_time: equilibrium.ids_properties.homogeneous_time

  # Time arrays
  equilibrium.time: equilibrium.time
  equilibrium.time_slice.time: equilibrium.time_slice.:.time

  # Boundary outline (ragged arrays)
  equilibrium.time_slice.boundary.outline.r: equilibrium.time_slice.:.boundary.outline.r
  equilibrium.time_slice.boundary.outline.z: equilibrium.time_slice.:.boundary.outline.z

  # Boundary X-points - nested array notation for ODS access
  equilibrium.time_slice.boundary.x_point.r: equilibrium.time_slice.:.boundary.x_point.:.r
  equilibrium.time_slice.boundary.x_point.z: equilibrium.time_slice.:.boundary.x_point.:.z

  # Boundary separatrix outline (ragged arrays, same as boundary for EFIT)
  equilibrium.time_slice.boundary_separatrix.outline.r: equilibrium.time_slice.:.boundary_separatrix.outline.r
  equilibrium.time_slice.boundary_separatrix.outline.z: equilibrium.time_slice.:.boundary_separatrix.outline.z

  # Boundary separatrix X-points
  equilibrium.time_slice.boundary_separatrix.x_point.r: equilibrium.time_slice.:.boundary_separatrix.x_point.:.r
  equilibrium.time_slice.boundary_separatrix.x_point.z: equilibrium.time_slice.:.boundary_separatrix.x_point.:.z

  # Boundary separatrix geometric axis
  equilibrium.time_slice.boundary_separatrix.geometric_axis.r: equilibrium.time_slice.:.boundary_separatrix.geometric_axis.r
  equilibrium.time_slice.boundary_separatrix.geometric_axis.z: equilibrium.time_slice.:.boundary_separatrix.geometric_axis.z

  # Boundary separatrix closest wall point
  equilibrium.time_slice.boundary_separatrix.closest_wall_point.distance: equilibrium.time_slice.:.boundary_separatrix.closest_wall_point.distance

  # Boundary separatrix gaps (4 gaps)
  equilibrium.time_slice.boundary_separatrix.gap.name: equilibrium.time_slice.:.boundary_separatrix.gap.:.name
  equilibrium.time_slice.boundary_separatrix.gap.value: equilibrium.time_slice.:.boundary_separatrix.gap.:.value

  # Boundary separatrix strike points (ragged, 0-4 points)
  equilibrium.time_slice.boundary_separatrix.strike_point.r: equilibrium.time_slice.:.boundary_separatrix.strike_point.:.r
  equilibrium.time_slice.boundary_separatrix.strike_point.z: equilibrium.time_slice.:.boundary_separatrix.strike_point.:.z

  # Boundary separatrix shape parameters
  equilibrium.time_slice.boundary_separatrix.triangularity_upper: equilibrium.time_slice.:.boundary_separatrix.triangularity_upper
  equilibrium.time_slice.boundary_separatrix.triangularity_lower: equilibrium.time_slice.:.boundary_separatrix.triangularity_lower
  equilibrium.time_slice.boundary_separatrix.elongation: equilibrium.time_slice.:.boundary_separatrix.elongation
  equilibrium.time_slice.boundary_separatrix.minor_radius: equilibrium.time_slice.:.boundary_separatrix.minor_radius
  equilibrium.time_slice.boundary_separatrix.psi: equilibrium.time_slice.:.boundary_separatrix.psi

  # Constraints - Plasma current
  equilibrium.time_slice.constraints.ip.measured: equilibrium.time_slice.:.constraints.ip.measured
  equilibrium.time_slice.constraints.ip.measured_error_upper: equilibrium.time_slice.:.constraints.ip.measured_error_upper
  equilibrium.time_slice.constraints.ip.weight: equilibrium.time_slice.:.constraints.ip.weight
  equilibrium.time_slice.constraints.ip.reconstructed: equilibrium.time_slice.:.constraints.ip.reconstructed
  equilibrium.time_slice.constraints.ip.chi_squared: equilibrium.time_slice.:.constraints.ip.chi_squared

  # Constraints - Poloidal field probe
  equilibrium.time_slice.constraints.bpol_probe.measured: equilibrium.time_slice.:.constraints.bpol_probe.:.measured
  equilibrium.time_slice.constraints.bpol_probe.measured_error_upper: equilibrium.time_slice.:.constraints.bpol_probe.:.measured_error_upper
  equilibrium.time_slice.constraints.bpol_probe.weight: equilibrium.time_slice.:.constraints.bpol_probe.:.weight
  equilibrium.time_slice.constraints.bpol_probe.reconstructed: equilibrium.time_slice.:.constraints.bpol_probe.:.reconstructed
  equilibrium.time_slice.constraints.bpol_probe.chi_squared: equilibrium.time_slice.:.constraints.bpol_probe.:.chi_squared

  # Constraints - Diamagnetic flux
  equilibrium.time_slice.constraints.diamagnetic_flux.measured: equilibrium.time_slice.:.constraints.diamagnetic_flux.measured
  equilibrium.time_slice.constraints.diamagnetic_flux.measured_error_upper: equilibrium.time_slice.:.constraints.diamagnetic_flux.measured_error_upper
  equilibrium.time_slice.constraints.diamagnetic_flux.weight: equilibrium.time_slice.:.constraints.diamagnetic_flux.weight
  equilibrium.time_slice.constraints.diamagnetic_flux.reconstructed: equilibrium.time_slice.:.constraints.diamagnetic_flux.reconstructed
  equilibrium.time_slice.constraints.diamagnetic_flux.chi_squared: equilibrium.time_slice.:.constraints.diamagnetic_flux.chi_squared

  # Constraints - Flux loop
  equilibrium.time_slice.constraints.flux_loop.measured: equilibrium.time_slice.:.constraints.flux_loop.:.measured
  equilibrium.time_slice.constraints.flux_loop.measured_error_upper: equilibrium.time_slice.:.constraints.flux_loop.:.measured_error_upper
  equilibrium.time_slice.constraints.flux_loop.weight: equilibrium.time_slice.:.constraints.flux_loop.:.weight
  equilibrium.time_slice.constraints.flux_loop.reconstructed: equilibrium.time_slice.:.constraints.flux_loop.:.reconstructed
  equilibrium.time_slice.constraints.flux_loop.chi_squared: equilibrium.time_slice.:.constraints.flux_loop.:.chi_squared

  # Constraints - MSE polarisation angle
  equilibrium.time_slice.constraints.mse_polarisation_angle.measured: equilibrium.time_slice.:.constraints.mse_polarisation_angle.:.measured
  equilibrium.time_slice.constraints.mse_polarisation_angle.measured_error_upper: equilibrium.time_slice.:.constraints.mse_polarisation_angle.:.measured_error_upper
  equilibrium.time_slice.constraints.mse_polarisation_angle.weight: equilibrium.time_slice.:.constraints.mse_polarisation_angle.:.weight
  equilibrium.time_slice.constraints.mse_polarisation_angle.reconstructed: equilibrium.time_slice.:.constraints.mse_polarisation_angle.:.reconstructed
  equilibrium.time_slice.constraints.mse_polarisation_angle.chi_squared: equilibrium.time_slice.:.constraints.mse_polarisation_angle.:.chi_squared

  # Constraints - PF current
  equilibrium.time_slice.constraints.pf_current.measured: equilibrium.time_slice.:.constraints.pf_current.:.measured
  equilibrium.time_slice.constraints.pf_current.measured_error_upper: equilibrium.time_slice.:.constraints.pf_current.:.measured_error_upper
  equilibrium.time_slice.constraints.pf_current.weight: equilibrium.time_slice.:.constraints.pf_current.:.weight
  equilibrium.time_slice.constraints.pf_current.reconstructed: equilibrium.time_slice.:.constraints.pf_current.:.reconstructed
  equilibrium.time_slice.constraints.pf_current.chi_squared: equilibrium.time_slice.:.constraints.pf_current.:.chi_squared

  # Constraints - Pressure
  equilibrium.time_slice.constraints.pressure.measured: equilibrium.time_slice.:.constraints.pressure.:.measured
  equilibrium.time_slice.constraints.pressure.measured_error_upper: equilibrium.time_slice.:.constraints.pressure.:.measured_error_upper
  equilibrium.time_slice.constraints.pressure.weight: equilibrium.time_slice.:.constraints.pressure.:.weight
  equilibrium.time_slice.constraints.pressure.reconstructed: equilibrium.time_slice.:.constraints.pressure.:.reconstructed
  equilibrium.time_slice.constraints.pressure.chi_squared: equilibrium.time_slice.:.constraints.pressure.:.chi_squared
 
  equilibrium.time_slice.constraints.j_tor.position.psi: equilibrium.time_slice.:.constraints.j_tor.:.position.psi
  equilibrium.time_slice.constraints.j_tor.measured: equilibrium.time_slice.:.constraints.j_tor.:.measured

  # Global quantities
  equilibrium.time_slice.global_quantities.ip: equilibrium.time_slice.:.global_quantities.ip
  equilibrium.time_slice.global_quantities.li_3: equilibrium.time_slice.:.global_quantities.li_3
  equilibrium.time_slice.global_quantities.magnetic_axis.r: equilibrium.time_slice.:.global_quantities.magnetic_axis.r
  equilibrium.time_slice.global_quantities.magnetic_axis.z: equilibrium.time_slice.:.global_quantities.magnetic_axis.z
  equilibrium.time_slice.global_quantities.magnetic_axis.b_field_tor: equilibrium.time_slice.:.global_quantities.magnetic_axis.b_field_tor
  equilibrium.time_slice.global_quantities.psi_axis: equilibrium.time_slice.:.global_quantities.psi_axis
  equilibrium.time_slice.global_quantities.psi_boundary: equilibrium.time_slice.:.global_quantities.psi_boundary
  equilibrium.time_slice.global_quantities.area: equilibrium.time_slice.:.global_quantities.area
  equilibrium.time_slice.global_quantities.surface: equilibrium.time_slice.:.global_quantities.surface
  equilibrium.time_slice.global_quantities.volume: equilibrium.time_slice.:.global_quantities.volume
  equilibrium.time_slice.global_quantities.beta_pol: equilibrium.time_slice.:.global_quantities.beta_pol
  equilibrium.time_slice.global_quantities.beta_tor: equilibrium.time_slice.:.global_quantities.beta_tor
  equilibrium.time_slice.global_quantities.beta_normal: equilibrium.time_slice.:.global_quantities.beta_normal
  equilibrium.time_slice.global_quantities.q_95: equilibrium.time_slice.:.global_quantities.q_95
  equilibrium.time_slice.global_quantities.q_axis: equilibrium.time_slice.:.global_quantities.q_axis
  equilibrium.time_slice.global_quantities.q_min.value: equilibrium.time_slice.:.global_quantities.q_min.value

# OMAS fetch mapping (machine_to_omas)
# Overrides omas_path_map entries when fetching data via machine_to_omas
# machine_to_omas supports wildcards (.*) that ODS class doesn't understand
# Only specify entries that differ from omas_path_map
omas_fetch_map:
  # Boundary X-points - use wildcard for fetching, but array notation for access
  equilibrium.time_slice.boundary.x_point.r: equilibrium.time_slice.:.boundary.x_point.*
  equilibrium.time_slice.boundary.x_point.z: equilibrium.time_slice.:.boundary.x_point.*

  # Boundary separatrix X-points - use wildcard for fetching
  equilibrium.time_slice.boundary_separatrix.x_point.r: equilibrium.time_slice.:.boundary_separatrix.x_point.*
  equilibrium.time_slice.boundary_separatrix.x_point.z: equilibrium.time_slice.:.boundary_separatrix.x_point.*

  # Boundary separatrix strike points - use wildcard for fetching
  equilibrium.time_slice.boundary_separatrix.strike_point.r: equilibrium.time_slice.:.boundary_separatrix.strike_point.*
  equilibrium.time_slice.boundary_separatrix.strike_point.z: equilibrium.time_slice.:.boundary_separatrix.strike_point.*

  # Gap - fetch time first (establishes all time slices), then gap data
  # Once time axis is populated, OMAS correctly broadcasts static gap names
  equilibrium.time_slice.boundary_separatrix.gap.name:
    - equilibrium.time_slice.:.time
    - equilibrium.time_slice.:.boundary_separatrix.gap.*
  equilibrium.time_slice.boundary_separatrix.gap.value:
    - equilibrium.time_slice.:.time
    - equilibrium.time_slice.:.boundary_separatrix.gap.*

  # Constraints arrays - use wildcard for fetching
  equilibrium.time_slice.constraints.bpol_probe.measured: equilibrium.time_slice.:.constraints.bpol_probe.*
  equilibrium.time_slice.constraints.bpol_probe.measured_error_upper: equilibrium.time_slice.:.constraints.bpol_probe.*
  equilibrium.time_slice.constraints.bpol_probe.weight: equilibrium.time_slice.:.constraints.bpol_probe.*
  equilibrium.time_slice.constraints.bpol_probe.reconstructed: equilibrium.time_slice.:.constraints.bpol_probe.*
  equilibrium.time_slice.constraints.bpol_probe.chi_squared: equilibrium.time_slice.:.constraints.bpol_probe.*

  # equilibrium.time_slice.constraints.flux_loop.measured: equilibrium.time_slice.:.constraints.flux_loop.*
  # equilibrium.time_slice.constraints.flux_loop.measured_error_upper: equilibrium.time_slice.:.constraints.flux_loop.*
  # equilibrium.time_slice.constraints.flux_loop.weight: equilibrium.time_slice.:.constraints.flux_loop.*
  # equilibrium.time_slice.constraints.flux_loop.reconstructed: equilibrium.time_slice.:.constraints.flux_loop.*
  # equilibrium.time_slice.constraints.flux_loop.chi_squared: equilibrium.time_slice.:.constraints.flux_loop.*

  equilibrium.time_slice.constraints.mse_polarisation_angle.measured: equilibrium.time_slice.:.constraints.mse_polarisation_angle.*
  equilibrium.time_slice.constraints.mse_polarisation_angle.measured_error_upper: equilibrium.time_slice.:.constraints.mse_polarisation_angle.*
  equilibrium.time_slice.constraints.mse_polarisation_angle.weight: equilibrium.time_slice.:.constraints.mse_polarisation_angle.*
  equilibrium.time_slice.constraints.mse_polarisation_angle.reconstructed: equilibrium.time_slice.:.constraints.mse_polarisation_angle.*
  equilibrium.time_slice.constraints.mse_polarisation_angle.chi_squared: equilibrium.time_slice.:.constraints.mse_polarisation_angle.*

  equilibrium.time_slice.constraints.pf_current.measured: equilibrium.time_slice.:.constraints.pf_current.*
  equilibrium.time_slice.constraints.pf_current.measured_error_upper: equilibrium.time_slice.:.constraints.pf_current.*
  equilibrium.time_slice.constraints.pf_current.weight: equilibrium.time_slice.:.constraints.pf_current.*
  equilibrium.time_slice.constraints.pf_current.reconstructed: equilibrium.time_slice.:.constraints.pf_current.*
  equilibrium.time_slice.constraints.pf_current.chi_squared: equilibrium.time_slice.:.constraints.pf_current.*

  equilibrium.time_slice.constraints.pressure.measured: equilibrium.time_slice.:.constraints.pressure.*
  equilibrium.time_slice.constraints.pressure.measured_error_upper: equilibrium.time_slice.:.constraints.pressure.*
  equilibrium.time_slice.constraints.pressure.weight: equilibrium.time_slice.:.constraints.pressure.*
  equilibrium.time_slice.constraints.pressure.reconstructed: equilibrium.time_slice.:.constraints.pressure.*
  equilibrium.time_slice.constraints.pressure.chi_squared: equilibrium.time_slice.:.constraints.pressure.*

  equilibrium.time_slice.constraints.j_tor.position.psi: equilibrium.time_slice.:.constraints.j_tor.:.position.psi
  equilibrium.time_slice.constraints.j_tor.measured: equilibrium.time_slice.:.constraints.j_tor.:.measured
